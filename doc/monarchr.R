## ----include=FALSE, message=FALSE-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
library(dplyr)
library(tidygraph)
library(monarchr)

options(width = 300)
knitr::opts_chunk$set(eval = TRUE, echo = TRUE, fig.width = 10, message = FALSE, warning = FALSE)

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ----message = TRUE, warning = TRUE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# MONDO:0001982 Niemann-Pick Disease (13 subtypes)

g <- monarch_engine() |>
  fetch_nodes(query_ids = c("MONDO:0001982")) |>
	expand(predicates = "biolink:subclass_of", direction = "in", transitive = TRUE) |>
	expand(categories = "biolink:Gene")

plot(g)
g

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
monarch <- monarch_engine()

## ----eval=FALSE-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  neodb <- neo4j_engine("http://localhost:7687", username = "user", password = "pass")

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
filename <- system.file("extdata", "mondo_kgx_tsv.tar.gz", package = "monarchr")
# filename <- "https://kghub.io/kg-obo/mondo/2024-03-04/mondo_kgx_tsv.tar.gz"

mondo <- file_engine(filename)

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
g <- monarch |>
	fetch_nodes(query_ids = c("MONDO:0009061", "HGNC:1884"))

g

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
h_sapiens_nodes <- monarch |>
	fetch_nodes(in_taxon_label == "Homo sapiens", limit = 20)
h_sapiens_nodes

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
human_genes <- monarch |>
	fetch_nodes(in_taxon_label == "Homo sapiens" & "biolink:Gene" %in_list% category, 
							limit = 20)

human_genes

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
fibrosis_disease_matches <- monarch |>
	fetch_nodes(description %~% ".*[fF]ibrosis.*" & "biolink:Disease" %in_list% category,
							limit = 20)
fibrosis_disease_matches

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# MONDO:0018982, MONDO:0011871: Neimann-Pick type B and C

g <- monarch |>
	fetch_nodes(query_ids = c("MONDO:0018982", "MONDO:0011871")) |>
	expand(predicates = c("biolink:causes", "biolink:gene_associated_with_condition")) |>
	expand(categories = c("biolink:PhenotypicFeature"), limit = 10)

plot(g)

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# MONDO:0001982 Niemann-Pick Disease (13 subtypes)

hierarchy <- monarch |>
  fetch_nodes(query_ids = c("MONDO:0001982")) |>
	expand(predicates = "biolink:subclass_of", direction = "in", transitive = TRUE) |>
	expand(predicates = "biolink:subclass_of", direction = "out", transitive = TRUE, categories = "biolink:Disease")

plot(hierarchy)

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
cf_hits <- monarch_search("Cystic fibrosis", category = "biolink:Disease", limit = 5)

cf_hits

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eds_phenos <- monarch |>
	fetch_nodes(query_ids = "MONDO:0007522") |> 
	expand(predicates = "biolink:has_phenotype", limit = 10)

marfan_phenos <- monarch |>
	fetch_nodes(query_ids = "MONDO:0007947") |> 
	expand(predicates = "biolink:has_phenotype", limit = 10)

sim <- monarch_semsim(eds_phenos, marfan_phenos)

plot(sim)
sim

## ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
eds_phenos |>
	graph_join(marfan_phenos) |>
	graph_join(sim) |>
	plot()

