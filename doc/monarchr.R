## ----setup, include=FALSE, message=FALSE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
library(dplyr)
library(tidygraph)
library(monarchr)

options(width = 300)
knitr::opts_chunk$set(echo = TRUE)

wrap <- function(labels, size = 20) {
	wrapped <- labels %>% lapply(strwrap, size)
	reformatted <- wrapped %>% lapply(paste, collapse = "\n")
	return(as.character(reformatted))
}

knitr::opts_chunk$set(eval = FALSE)

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ----welcome, eval=TRUE, echo=TRUE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	# MONDO:0001982 Niemann-Pick Disease (13 subtypes)

g <- monarch_engine() |>
  fetch_nodes(query_ids = c("MONDO:0001982")) |>
	expand(predicates = "biolink:subclass_of", direction = "in", transitive = TRUE) |>
	expand(result_categories = "biolink:Gene")

g

## ----welcome_plot, eval=TRUE, echo=TRUE, fig.width=10, warning=FALSE, message=FALSE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
library(ggraph)
library(stringr) # for str_wrap()

ggraph(g, layout = "sugiyama") +
	geom_edge_link(aes(color = predicate),
								 arrow = arrow(length = unit(2, 'mm'), type = "closed"),
								 end_cap = circle(2.5, 'mm')) +
	geom_node_point(aes(color = pcategory),
									size = 3) +
	geom_node_label(aes(label = str_wrap(name, 20)), 
								 size = 2, 
								 repel = TRUE, 
								 check_overlap = TRUE,
								 fill = "#FFFFFF88")

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ----monarch_engine, eval=TRUE, echo=TRUE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
g <- monarch_engine() |>
	search_nodes("cystic fibrosis", limit = 5)

g

## ----neo4j_engine, eval=FALSE, echo=TRUE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  # not run:
#  g <- neo4j_engine("http://localhost:7687", username = "user", password = "pass") |>
#  	search_nodes("cystic fibrosis", limit = 5)
#  
#  g

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ----file_engine_demo, eval=TRUE, echo=TRUE---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
filename <- system.file("extdata", "mondo_kgx_tsv.tar.gz", package = "monarchr")
# filename <- "https://kghub.io/kg-obo/mondo/2024-03-04/mondo_kgx_tsv.tar.gz"

print(filename)
	
g <- file_engine(filename) |>
	search_nodes("cystic fibrosis", limit = 5)

g

## ----file_engine_default_prefs, eval=TRUE, echo=TRUE------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
filename <- system.file("extdata", "mondo_kgx_tsv.tar.gz", package = "monarchr")

e <- file_engine(filename)

e$preferences

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ----file_engine, eval=TRUE, echo=TRUE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
filename <- system.file("extdata", "mondo_kgx_tsv.tar.gz", package = "monarchr")
g <- file_engine(filename,
								 preferences = list(node_search_properties = c("name"))) |>
	search_nodes("cystic fibrosis", limit = 5)

g

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
nodes_kbl

## ----eval=TRUE, echo=FALSE--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
edges_kbl

## ----search_fancy, eval=TRUE, echo=TRUE-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
g <- monarch_engine() |>
	search_nodes("cystic fibrosis", category = c("biolink:Gene", "biolink:PhenotypicFeature"), limit = 50)

g

## ----fetch_nodes_query_ids, eval=TRUE, echo=TRUE----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
g <- monarch_engine() |>
	fetch_nodes(query_ids = c("MONDO:0009061", "HGNC:1884"))

str(g)

## ----mondo_nodes_explore, eval=FALSE, echo=TRUE-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#  #g <- file_engine(system.file("extdata", "mondo_kgx_tsv.tar.gz", package = "monarchr")) |>
#  #	search_nodes("cystic fibrosis", limit = 5)
#  
#  g <- monarch_engine() |>
#  	fetch_nodes(in_taxon_label == "Homo sapiens") |>
#  	expand(result_categories = "biolink:PhenotypicFeature")
#  	
#  g

